<ion-header [translucent]="true">
  <ion-toolbar color="tertiary"> 
    <ion-buttons slot="start">
      <ion-button (click)="volverAtras()">
        <ion-icon name="arrow-back"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Ficha Médica</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="editarFicha()">
        <ion-icon name="create"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  
  <!-- Estado de carga -->
  @if (cargando) {
    <div class="cargando-container">
      <ion-spinner name="crescent"></ion-spinner>
      <p>Cargando ficha médica...</p>
    </div>
  }

  <!-- Estado de error -->
  @if (error && !cargando) {
    <div class="error-container">
      <ion-card color="danger">
        <ion-card-content>
          <p>{{ error }}</p>
          <ion-button (click)="cargarFicha()" fill="clear" color="light">
            Reintentar
          </ion-button>
        </ion-card-content>
      </ion-card>
    </div>
  }

  <!-- Datos de la ficha -->
  @if (!cargando && !error && ficha) {
    
    <!-- Header del paciente CON CONTENEDOR FIXED -->
    <div class="paciente-header">
      <div class="avatar-container">
        <ion-avatar class="avatar-paciente">
          <img [src]="getAvatar()" [alt]="ficha.paciente.nombrePaciente" />
        </ion-avatar>
      </div>
      <div class="info-basica">
        <h1>{{ ficha.paciente.nombrePaciente }}</h1>
        <p class="edad">{{ calcularEdad(ficha.paciente.fechaNacimiento) }} años</p>
        <div class="badges">
          <ion-badge color="danger" class="sangre-badge">
            {{ ficha.paciente.tipoSangre }}
          </ion-badge>
          <ion-badge [color]="getPrevisionColor(ficha.paciente.prevision)" class="prevision-badge">
            {{ ficha.paciente.prevision }}
          </ion-badge>
        </div>
      </div>
    </div>

    <!-- Resto del contenido se mantiene igual -->
    <!-- Información de contacto -->
    <ion-card class="contacto-card">
      <ion-card-content>
        <ion-grid>
          <ion-row>
            <ion-col size="6">
              <div class="contacto-item">
                <div>
                  <small>Teléfono</small>
                  <p>{{ ficha.paciente.telefono || 'No registrado' }}</p>
                </div>
              </div>
            </ion-col>
            <ion-col size="6">
              <div class="contacto-item">
                <div>
                  <small>Dirección</small>
                  <p>{{ ficha.paciente.direccion || 'No registrada' }}</p>
                </div>
              </div>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col size="6">
              <div class="contacto-item">
                <div>
                  <small>Ocupación</small>
                  <p>{{ ficha.paciente.ocupacion || 'No registrada' }}</p>
                </div>
              </div>
            </ion-col>
            <ion-col size="6">
              <div class="contacto-item">
                <div>
                  <small>Nacionalidad</small>
                  <p>{{ ficha.paciente.nacionalidad || 'No registrada' }}</p>
                </div>
              </div>
            </ion-col>
          </ion-row>
        </ion-grid>
      </ion-card-content>
    </ion-card>

    <!-- Sección de Alergias -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          Alergias
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="info-medica">
          <p>{{ getAlergiasTexto() }}</p>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Sección de Medicamentos -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          Medicamentos
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="info-medica">
          <p>{{ getMedicamentosTexto() }}</p>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Sección de Hábitos -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          Hábitos
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="info-medica">
          <p>{{ getHabitosTexto() }}</p>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Sección de Consultas -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          Últimas Consultas
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="info-medica">
          <p>{{ getConsultasTexto() }}</p>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Sección de Exámenes -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          Exámenes Recientes
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="info-medica">
          <p>{{ getExamenesTexto() }}</p>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Botones de acción -->
    <div class="botones-accion">
      <ion-button expand="block" color="tertiary" (click)="editarFicha()">
        Editar Ficha
      </ion-button>
      
      <ion-button expand="block" fill="outline" color="medium" (click)="imprimirFicha()">
        Imprimir Ficha
      </ion-button>
    </div>

  }

</ion-content>