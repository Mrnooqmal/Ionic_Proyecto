<ion-header [translucent]="true">
  <ion-toolbar color="tertiary"> 
    <ion-buttons slot="start">
      <ion-button routerLink="/fichas/buscarFichas">
        <ion-icon name="arrow-back"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Ficha Médica</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="editarFicha()">
        <ion-icon name="create"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  
  <!-- Estado de carga -->
  <div *ngIf="cargando" class="cargando-container">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Cargando ficha médica...</p>
  </div>

  <!-- Estado de error -->
  <div *ngIf="error && !cargando" class="error-container">
    <ion-card color="danger">
      <ion-card-content>
        <p>{{ error }}</p>
        <ion-button (click)="cargarFicha()" fill="clear" color="light">
          Reintentar
        </ion-button>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Datos de la ficha -->
  <div *ngIf="!cargando && !error && ficha">
    
    <div class="paciente-header">
      <div class="avatar-container">
        <ion-avatar slot="start">
          <img [src]="getAvatar(paciente)" alt="{{ paciente?.nombrePaciente }}">
        </ion-avatar>
      </div>
      <div class="info-basica">
        <h2>{{ficha.paciente.nombrePaciente}}</h2>
        <p>Email: {{ficha.paciente.correo}}</p>
        <ion-badge color="danger">{{ficha.paciente.tipoSangre}}</ion-badge>
      </div>
    </div>

    <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="person" class="icono-seccion"></ion-icon>
          Datos del Paciente
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-grid>
          <ion-row>
            <ion-col size="12" size-md="6">
              <div class="dato-item">
                <h4>Nombre Completo</h4>
                <p>{{ficha.paciente.nombrePaciente}}</p>
              </div>
            </ion-col>
            <ion-col size="12" size-md="6">
              <div class="dato-item">
                <h4>Email</h4>
                <p>{{ficha.paciente.correo}}</p>
              </div>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col size="12" size-md="6">
              <div class="sangre-item">
                <h4>Tipo de Sangre</h4>
                <ion-badge color="danger">{{ficha.paciente.tipoSangre}}</ion-badge>
              </div>
            </ion-col>
            <ion-col size="12" size-md="6">
              <div class="dato-item">
                <h4>Teléfono</h4>
                <p>{{ficha.paciente.telefono}}</p>
              </div>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col size="12" size-md="6">
              <div class="dato-item">
                <h4>Ocupación</h4>
                <p>{{ficha.paciente.ocupacion}}</p>
              </div>
            </ion-col>
            <ion-col size="12" size-md="6">
              <div class="dato-item">
                <h4>Previsión</h4>
                <p>{{ficha.paciente.prevision}}</p>
              </div>
            </ion-col>
          </ion-row>
        </ion-grid>
      </ion-card-content>
    </ion-card>

    <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="medical" class="icono-seccion"></ion-icon>
          Exámenes Médicos
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="info-medica">
          <p>{{ficha.examenes.length > 0 ? (ficha.examenes | json) : 'No registra exámenes'}}</p>
        </div>
      </ion-card-content>
    </ion-card>

    <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="clipboard" class="icono-seccion"></ion-icon>
          Consultas
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="info-medica">
          <p>{{getConsultasTexto()}}</p>
        </div>
      </ion-card-content>
    </ion-card>

    <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="analytics" class="icono-seccion"></ion-icon>
          Diagnosticos
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="info-medica">
          <p>{{ficha.diagnosticos.length > 0 ? (ficha.diagnosticos | json) : 'No registra diagnósticos'}}</p>
        </div>
      </ion-card-content>
    </ion-card>

    <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="construct" class="icono-seccion"></ion-icon>
          Procedimientos
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="info-medica">
          <p>{{ficha.procedimientos.length > 0 ? (ficha.procedimientos | json) : 'No registra procedimientos'}}</p>
        </div>
      </ion-card-content>
    </ion-card>

    <ion-grid>
      <ion-row>
        <ion-col size="12" size-md="6">
          <ion-card>
            <ion-card-header>
              <ion-card-title class="titulo-pequeño">
                <ion-icon name="warning" class="icono-seccion"></ion-icon>
                Alergias
              </ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <div class="info-medica-pequeña">
                <p>{{getAlergiasTexto()}}</p>
              </div>
            </ion-card-content>
          </ion-card>
        </ion-col>
        <ion-col size="12" size-md="6">
          <ion-card>
            <ion-card-header>
              <ion-card-title class="titulo-pequeño">
                <ion-icon name="fitness" class="icono-seccion"></ion-icon>
                Medicamentos
              </ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <div class="info-medica-pequeña">
                <p>{{getMedicamentosTexto()}}</p>
              </div>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
      <ion-row>
        <ion-col size="12" size-md="6">
          <ion-card>
            <ion-card-header>
              <ion-card-title class="titulo-pequeño">
                <ion-icon name="cafe" class="icono-seccion"></ion-icon>
                Hábitos
              </ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <div class="info-medica-pequeña">
                <p>{{getHabitosTexto()}}</p>
              </div>
            </ion-card-content>
          </ion-card>
        </ion-col>
        <ion-col size="12" size-md="6">
          <ion-card>
            <ion-card-header>
              <ion-card-title class="titulo-pequeño">
                <ion-icon name="person" class="icono-seccion"></ion-icon>
                Información Adicional
              </ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <div class="info-medica-pequeña">
                <p><strong>Nacionalidad:</strong> {{ficha.paciente.nacionalidad}}</p>
                <p><strong>Dirección:</strong> {{ficha.paciente.direccion}}</p>
                <p><strong>Sexo:</strong> {{ficha.paciente.sexo}}</p>
              </div>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>

    <div class="botones-accion">
      <ion-button expand="block" color="tertiary" (click)="editarFicha()">
        <ion-icon name="create" slot="start"></ion-icon>
        Editar Ficha
      </ion-button>
      
      <ion-button expand="block" fill="outline" color="medium" (click)="imprimirFicha()">
        <ion-icon name="print" slot="start"></ion-icon>
        Imprimir Ficha
      </ion-button>
    </div>

  </div>

</ion-content>